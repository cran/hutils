<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Hugh Parsonage" />

<meta name="date" content="2018-03-05" />

<title>Hutils</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Hutils</h1>
<h4 class="author"><em>Hugh Parsonage</em></h4>
<h4 class="date"><em>2018-03-05</em></h4>



<div id="hutils-package" class="section level1">
<h1><code>hutils</code> package</h1>
<p>My name is Hugh. I’ve written some miscellaneous functions that don’t seem to belong in a particular package. I’ve usually put these in <code>R/utils.R</code> when I write a package. Thus, <code>hutils</code>.</p>
<p>This vignette just goes through each exported function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(knitr)
suggested_packages &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;geosphere&quot;</span>, <span class="st">&quot;nycflights13&quot;</span>, <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>, <span class="st">&quot;microbenchmark&quot;</span>)
opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">eval =</span> <span class="kw">all</span>(<span class="kw">vapply</span>(suggested_packages, requireNamespace, <span class="dt">quietly =</span> <span class="ot">TRUE</span>, <span class="dt">FUN.VALUE =</span> <span class="ot">FALSE</span>)))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tryCatch</span>({
  <span class="kw">library</span>(geosphere)
  <span class="kw">library</span>(nycflights13)
  <span class="kw">library</span>(dplyr, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)
  <span class="kw">library</span>(ggplot2)
  <span class="kw">library</span>(microbenchmark)
  <span class="kw">library</span>(data.table, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)
  <span class="kw">library</span>(magrittr)
  <span class="kw">library</span>(hutils, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)
}, 
<span class="co"># requireNamespace does not detect errors like</span>
<span class="co"># package ‘dplyr’ was installed by an R version with different internals; it needs to be reinstalled for use with this R version</span>
<span class="dt">error =</span> <span class="cf">function</span>(e) {
  opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">eval =</span> <span class="ot">FALSE</span>)
})</code></pre></div>
<div id="aliases" class="section level2">
<h2>Aliases</h2>
<p>These are simple additions to <code>magrittr</code>‘s aliases, including: capitalized forms of <code>and</code> and <code>or</code> that invoke <code>&amp;&amp;</code> and <code>||</code> (the ’long-form’ logical operators) and <code>nor</code> / <code>neither</code> functions.</p>
<p>The main motivation is to make the source code easier to indent. I occasionally find such source code easier to use.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">OR</span>(<span class="kw">OR</span>(<span class="ot">TRUE</span>,
      <span class="kw">stop</span>(<span class="st">&quot;Never happens&quot;</span>)),  ## short-circuits
   <span class="kw">AND</span>(<span class="ot">FALSE</span>,
       <span class="kw">stop</span>(<span class="st">&quot;Never happens&quot;</span>)))  </code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p><code>nor</code> (or <code>neither</code> which is identical) returns <code>TRUE</code> if and only if both arguments are <code>FALSE</code>.</p>
</div>
<div id="coalesce-and-if_else" class="section level2">
<h2><code>coalesce</code> and <code>if_else</code></h2>
<p>These are near drop-in replacements for the equivalent functions from <code>dplyr</code>. They are included here because they are very useful outside of the tidyverse, but may be required in circumstances where importing <code>dplyr</code> (with all of its dependencies) would be inappropriate.</p>
<p>They attempt to be drop-in replacements but:</p>
<ol style="list-style-type: decimal">
<li><code>hutils::if_else</code> only works with <code>logical</code>, <code>integer</code>, <code>double</code>, and <code>character</code> type vectors. Lists and factors won’t work.</li>
<li><code>hutils::coalesce</code> short-circuits on its first argument; if there are no <code>NA</code>s in <code>x</code> then <code>x</code> is returned, even if the other vectors are the wrong length or type.</li>
</ol>
<p>In addition, <code>hutils::if_else</code> is generally faster than <code>dplyr::if_else</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_check &lt;-<span class="st"> </span><span class="cf">function</span>(values) {
  <span class="kw">all</span>(<span class="kw">vapply</span>(values[<span class="op">-</span><span class="dv">1</span>], <span class="cf">function</span>(x) <span class="kw">identical</span>(values[[<span class="dv">1</span>]], x), <span class="kw">logical</span>(<span class="dv">1</span>)))
}


cnd &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
yes &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
no &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
na &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)

<span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr<span class="op">::</span><span class="kw">if_else</span>(cnd, yes, no, na),
               <span class="dt">hutils =</span> hutils<span class="op">::</span><span class="kw">if_else</span>(cnd, yes, no, na),
               <span class="dt">check =</span> my_check) <span class="op">%T&gt;%</span>
<span class="st">  </span>print <span class="op">%&gt;%</span>
<span class="st">  </span>autoplot</code></pre></div>
<pre><code>## Unit: milliseconds
##    expr      min       lq      mean   median        uq      max neval cld
##   dplyr 7.301119 8.760620 15.830360 9.743208 11.127717 66.33742   100   b
##  hutils 2.865092 4.258334  6.775741 4.963990  5.538182 59.04263   100  a</code></pre>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cnd &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
yes &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
no &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
na &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)

<span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr<span class="op">::</span><span class="kw">if_else</span>(cnd, yes, no, na),
               <span class="dt">hutils =</span> hutils<span class="op">::</span><span class="kw">if_else</span>(cnd, yes, no, na),
               <span class="dt">check =</span> my_check) <span class="op">%T&gt;%</span>
<span class="st">  </span>print <span class="op">%&gt;%</span>
<span class="st">  </span>autoplot</code></pre></div>
<pre><code>## Unit: milliseconds
##    expr      min       lq      mean   median       uq      max neval cld
##   dplyr 5.012781 6.522728 11.285779 7.163632 7.748817 112.0084   100   b
##  hutils 1.756461 1.917741  5.854237 2.291501 3.935171 105.6837   100  a</code></pre>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>This speed advantage also appears to be true of <code>coalesce</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
A &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
B &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
C &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)

<span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr<span class="op">::</span><span class="kw">coalesce</span>(x, A, B, C),
               <span class="dt">hutils =</span> hutils<span class="op">::</span><span class="kw">coalesce</span>(x, A, B, C),
               <span class="dt">check =</span> my_check) <span class="op">%T&gt;%</span>
<span class="st">  </span>print <span class="op">%&gt;%</span>
<span class="st">  </span>autoplot</code></pre></div>
<pre><code>## Unit: microseconds
##    expr      min       lq     mean   median       uq      max neval cld
##   dplyr 2296.169 3768.169 8304.247 4312.244 4794.127 107775.4   100   a
##  hutils  897.807 1164.348 3890.311 1245.515 2719.925 106293.0   100   a</code></pre>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>especially during short-circuits:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)

<span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr<span class="op">::</span><span class="kw">coalesce</span>(x, A, B, C),
               <span class="dt">hutils =</span> hutils<span class="op">::</span><span class="kw">coalesce</span>(x, A, B, C),
               <span class="dt">check =</span> my_check) <span class="op">%T&gt;%</span>
<span class="st">  </span>print <span class="op">%&gt;%</span>
<span class="st">  </span>autoplot</code></pre></div>
<pre><code>## Unit: microseconds
##    expr      min       lq       mean   median       uq        max neval
##   dplyr 2126.005 2387.275 7122.47632 4386.183 4807.529 109265.904   100
##  hutils   41.563   46.833   64.53324   56.471   76.198    167.756   100
##  cld
##    b
##   a</code></pre>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
A &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)

<span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr<span class="op">::</span><span class="kw">coalesce</span>(x, A, B, C),
               <span class="dt">hutils =</span> hutils<span class="op">::</span><span class="kw">coalesce</span>(x, A, B, C),
               <span class="dt">check =</span> my_check) <span class="op">%T&gt;%</span>
<span class="st">  </span>print <span class="op">%&gt;%</span>
<span class="st">  </span>autoplot</code></pre></div>
<pre><code>## Unit: microseconds
##    expr      min       lq     mean   median        uq      max neval cld
##   dplyr 2459.708 2589.515 6194.091 4458.014 4801.2045 108074.1   100   b
##  hutils  691.200  738.635 2128.866  762.278  828.2355 104573.9   100  a</code></pre>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAA0lBMVEUAAAAAADoAAGYAOpAAZrYzMzM6AAA6ADo6AGY6kNtNTU1NTW5NTY5Nbo5NbqtNjshmAABmtv9uTU1uTW5uTY5ubo5ubqtujshuq6tuq+SOTU2OTW6OTY6Obk2ObquOjk2Ojm6Ojo6OyP+QOgCQkDqQkGaQtpCQ2/+rbk2rbm6rbo6rq26ryKur5Mir5OSr5P+2ZgC2///Ijk3Ijm7I5KvI/8jI///bkDrb///kq27k5Kvk///r6+v/tmb/yI7/25D/5Kv//7b//8j//9v//+T///8WowOdAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAH/klEQVR4nO2dj3+TRhiHoytVsavVqVtqdVvcpt2vara1y2rTtIb//1/aHXAEEsg3NHcZWZ73U9MSHl7ufbjjSD8WegmxNHr/dQO6HggSgSARCBKBIBEIErGuoE8N0bhiW2AECRhBAkaQgBEkYAQJGEECRpCAESRgBAkYQQJGkIARJGAECRhBAkaQgIMIijZeRjg4hKAIQQhaT1AS1e8sXBnhYAQJGEECRpCAESTgAIKiBEEIQlCxEETQzFAXa24FI0jACBIwggSMIAEjSMAIEjCCBIwgASNIwAgSsH9B1g+CELSmoMJQF2tuBSNIwAgSMIIEjCABI0jACBIwggSMIAGHEuQMdbHmVjCCBIwgASNIwAgScDBBuaEu1twKRpCAESRgBAm4M4KiKNoxQZmh1QUlUYSg5jB2kvL/0G9ZRjh4BUGT5+fVpexLCkoNrdKyyMbM6V3KCAffRdDCe02CItmymZtii/A1t4JXEvRtHA9SJ5Pnfx3HB39mPWgcxweFplnGUr3qtFKR01ZROEFR5a9xVhD0rJ+MDy8zQefF1+3JeTJ6khVV6QXVepfH4t7UFpuJxXaJIZafdiqCXp2VoJL/Sq3LD91CY1qMsYBDrG0Pqhdkelb8uHA0y1gStELLonQCc5a29RxUL8iEGXlrCkq3cP2o1TzfOUF2SI0OZoKsnKWC2l4oJtt6oZgLSkZx/M3J+fS9m8WGYhbjSrocs4xOUNsPq/qiaUkZ4eDuCOoojCABI0jACBJwMEHRRssIByNIwAgSMIIEHEpQVLezcGWEgxEkYAQJGEECRpCAESRgBAkYQQJGkIADCYpqdxaujHAwggTsXxB/1IsgBJUXELQcRpCAESRgBAkYQQJGkIARJGAECTiMoKh+Z+HKCAcjSMAIEjCCBBxAEHckRxCCSgsIWg4HERQ17CxcGeFgBAk4hCAen4WgNQVtvoxwMIIEjCABI0jACBIwggSMIAEjSMAIEjCCBIwgASNIwAgSMIIEjCABI0jACBIwggSMIAEjSMAIEjCCBIwgASNIwAgSMIIEjCABI0jACBIwggSMIAEjSMAIEjCCBIwgASNIwAgSMIIEjCABI0jACBIwggSMIAEjSMAIEnBnBWVPaVq1jDaZ28FdFeQe9tOsaLcFFQ/Vaja004KiWeJGQ7ssKCpnbjK0u4LmH6DXYGhnBa36YMjdETSb0JNPdX4aDO2QoFxC4wMq6w11T9D0/SD/aeExtB4ELY8aQwgSijom6PY4/vL14PbkF/voUCNoOEgmL/958do95XCNlq0maOGyumOChv1kHA9ujw8vx+mTMsdmuT95NshbvmqRtYW3QDcWC7sWguxzi80Quz0eJNPTM/tQ0TeXf5yVhtoah25lQc3ltOsUS5qymHFFQamK4SB9fPFwYJamp7+9udyooHkP3RpirgcZQVkPSkbf95MNClrsJt0SVJyDnhQPDv/qzLOg+rHv1nmsuRW8qqDp+3QWe/VdPosl05/PfQpKx31S9wT6Bj9dE5RF6RHqk68ra9Zo2eyk2PhRw2/NreC7Cho9Pqus8diyBUN8mp+D5zoRvw9agCuG+IVZDVwyxO+ka2F+aa/gbL5f9iFixwWVZ3/fmVvB3RXUERhBAkaQgBEkYAQJGEECRpCAESRgBAkYQQJGkIARJGAECRhBAkaQgBEkYAQJGEECRpCAESRgBAkYQQJGkIARJGAECRhBAkaQgBEkYAQJGEECRpCAESRgBAkYQQJGkIARJGAECRhBAkaQgBEkYAQJGEECRpCAESRgBAkYQQJGkIARJGAECRhBAvYlqCmiQHk3nhlBIjOCRGYEicyhBP1vAkEiECQCQSIQJMKboJrbmN4ex4eXSTKO44OFdV4yl2+j6jfzKHaN9iVovCjBNn70JG2F+RYgc2ILWUPQkszDIq0nQcPHv9qjYfyn+7S3X0xf8mNUc6i8ZJ68eH13QUsyT0+LO7X5HWLDfnZk051NXl66u8Ot04OWZJ6e/r7+EKvLbKTFed/0Ksg22uzHnHRM9MeHuaDJs7lb5/nKPOqvfw6qzWzvppn3Ir+CrHgrY74Hle7D6DGz+eZBUFOb8/OQX0En+alm/hxUOul5zDzKjnrYNns/B42z+TexM0I6uouR5j1z4mWab2qzvSdr4luQ6a+l083smmLtc1B9Zi+CRJu5khaBIBEIEoEgEQgSgSARCBKBIBGbEfT5bS+LvesH7xqp6/3eXvWNJfDKcXX/o/vxQ+9e64Sb60G6Wi8+FqIk6C57QJCITQsyr9cPftrv9R6ZAdV7mo2+vARLVFbaN+x6M/CuH/5gsHzBDsbKxu59B6dJzPqbo969Hw3g+C0RtP/F38lFz77Ykk1BF+bnnKisNG/Y9TdHxtX+nq1/L/2Xprref+o2dlCxfj/b/ubokXk/zZPyWyPoadZcu5AOAFtc4gSVVmZf2db2rRQ2L9cPsy7nNnZQsb6c/GLGb4ug9HjmLxfZ7PbIEZWVrka39ZXtafanD9mIchs7yK0vkqfLxk7Ob6WgbHQVxGqC0rPL/Y9uYyko57dR0FXpyqROUDHEUkEWdjbM0HIbF0MsX18kz4ec47dR0Oe35ijnhdYJqpyX3UJac2lj9371JP7g3c3RXnqSdvw2Ckpn5lJHmBc0m7kt46bzq162kdt4YZrPk7hp3vGdFqQjzIXimntAkIhOCZr/sOo7uv1hdUsDQSIQJAJBIhAkAkEiECTiX6LNQLcXI+FJAAAAAElFTkSuQmCC" /><!-- --></p>
</div>
<div id="drop-columns" class="section level2">
<h2>Drop columns</h2>
<p>To drop a column from a <code>data.table</code>, you set it to <code>NULL</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">A =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">B =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">C =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)
DT[, A <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</code></pre></div>
<p>There’s nothing wrong with this, but I’ve found the following a useful alias, especially in a <code>magrittr</code> pipe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">A =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">B =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">C =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)
DT <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">drop_col</span>(<span class="st">&quot;A&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">drop_col</span>(<span class="st">&quot;B&quot;</span>)</code></pre></div>
<pre><code>##    C
## 1: 1
## 2: 2
## 3: 3
## 4: 4
## 5: 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># or</span>
DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">A =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">B =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">C =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)
DT <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">drop_cols</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>))</code></pre></div>
<pre><code>##    C
## 1: 1
## 2: 2
## 3: 3
## 4: 4
## 5: 5</code></pre>
<p>These functions simple invoke the canonical form, so won’t be any faster.</p>
<p>Additionally, one can drop columns by a regular expression using <code>drop_colr</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(flights)

flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">drop_colr</span>(<span class="st">&quot;time&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">drop_colr</span>(<span class="st">&quot;arr(?!_delay)&quot;</span>, <span class="dt">perl =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##         year month day dep_delay arr_delay flight tailnum origin dest
##      1: 2013     1   1         2        11   1545  N14228    EWR  IAH
##      2: 2013     1   1         4        20   1714  N24211    LGA  IAH
##      3: 2013     1   1         2        33   1141  N619AA    JFK  MIA
##      4: 2013     1   1        -1       -18    725  N804JB    JFK  BQN
##      5: 2013     1   1        -6       -25    461  N668DN    LGA  ATL
##     ---                                                              
## 336772: 2013     9  30        NA        NA   3393      NA    JFK  DCA
## 336773: 2013     9  30        NA        NA   3525      NA    LGA  SYR
## 336774: 2013     9  30        NA        NA   3461  N535MQ    LGA  BNA
## 336775: 2013     9  30        NA        NA   3572  N511MQ    LGA  CLE
## 336776: 2013     9  30        NA        NA   3531  N839MQ    LGA  RDU
##         distance hour minute
##      1:     1400    5     15
##      2:     1416    5     29
##      3:     1089    5     40
##      4:     1576    5     45
##      5:      762    6      0
##     ---                     
## 336772:      213   14     55
## 336773:      198   22      0
## 336774:      764   12     10
## 336775:      419   11     59
## 336776:      431    8     40</code></pre>
</div>
<div id="drop_constant_cols" class="section level2">
<h2><code>drop_constant_cols</code></h2>
<p>When a table is filtered, the filtrate is often redundant.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span>.[origin <span class="op">==</span><span class="st"> &quot;JFK&quot;</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>drop_constant_cols</code></pre></div>
<pre><code>##         month day dep_time sched_dep_time dep_delay arr_time
##      1:     1   1      542            540         2      923
##      2:     1   1      544            545        -1     1004
##      3:     1   1      557            600        -3      838
##      4:     1   1      558            600        -2      849
##      5:     1   1      558            600        -2      853
##     ---                                                     
## 111275:     9  30     2240           2250       -10     2347
## 111276:     9  30     2241           2246        -5     2345
## 111277:     9  30     2307           2255        12     2359
## 111278:     9  30     2349           2359       -10      325
## 111279:     9  30       NA           1455        NA       NA
##         sched_arr_time arr_delay carrier flight tailnum dest air_time
##      1:            850        33      AA   1141  N619AA  MIA      160
##      2:           1022       -18      B6    725  N804JB  BQN      183
##      3:            846        -8      B6     79  N593JB  MCO      140
##      4:            851        -2      B6     49  N793JB  PBI      149
##      5:            856        -3      B6     71  N657JB  TPA      158
##     ---                                                              
## 111275:              7       -20      B6   2002  N281JB  BUF       52
## 111276:              1       -16      B6    486  N346JB  ROC       47
## 111277:           2358         1      B6    718  N565JB  BOS       33
## 111278:            350       -25      B6    745  N516JB  PSE      196
## 111279:           1634        NA      9E   3393      NA  DCA       NA
##         distance hour minute           time_hour
##      1:     1089    5     40 2013-01-01 05:00:00
##      2:     1576    5     45 2013-01-01 05:00:00
##      3:      944    6      0 2013-01-01 06:00:00
##      4:     1028    6      0 2013-01-01 06:00:00
##      5:     1005    6      0 2013-01-01 06:00:00
##     ---                                         
## 111275:      301   22     50 2013-09-30 22:00:00
## 111276:      264   22     46 2013-09-30 22:00:00
## 111277:      187   22     55 2013-09-30 22:00:00
## 111278:     1617   23     59 2013-09-30 23:00:00
## 111279:      213   14     55 2013-09-30 14:00:00</code></pre>
</div>
<div id="drop_empty_cols" class="section level2">
<h2><code>drop_empty_cols</code></h2>
<p>This function drops columns in which all the values are <code>NA</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">planes <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>as.data.table <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>.[<span class="op">!</span><span class="kw">complete.cases</span>(.)]</code></pre></div>
<pre><code>##       tailnum year                    type                  manufacturer
##    1:  N10156 2004 Fixed wing multi engine                       EMBRAER
##    2:  N102UW 1998 Fixed wing multi engine              AIRBUS INDUSTRIE
##    3:  N103US 1999 Fixed wing multi engine              AIRBUS INDUSTRIE
##    4:  N104UW 1999 Fixed wing multi engine              AIRBUS INDUSTRIE
##    5:  N10575 2002 Fixed wing multi engine                       EMBRAER
##   ---                                                                   
## 3295:  N997AT 2002 Fixed wing multi engine                        BOEING
## 3296:  N997DL 1992 Fixed wing multi engine MCDONNELL DOUGLAS AIRCRAFT CO
## 3297:  N998AT 2002 Fixed wing multi engine                        BOEING
## 3298:  N998DL 1992 Fixed wing multi engine MCDONNELL DOUGLAS CORPORATION
## 3299:  N999DN 1992 Fixed wing multi engine MCDONNELL DOUGLAS CORPORATION
##           model engines seats speed    engine
##    1: EMB-145XR       2    55    NA Turbo-fan
##    2:  A320-214       2   182    NA Turbo-fan
##    3:  A320-214       2   182    NA Turbo-fan
##    4:  A320-214       2   182    NA Turbo-fan
##    5: EMB-145LR       2    55    NA Turbo-fan
##   ---                                        
## 3295:   717-200       2   100    NA Turbo-fan
## 3296:     MD-88       2   142    NA Turbo-fan
## 3297:   717-200       2   100    NA Turbo-fan
## 3298:     MD-88       2   142    NA Turbo-jet
## 3299:     MD-88       2   142    NA Turbo-jet</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">planes <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>as.data.table <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>.[<span class="op">!</span><span class="kw">complete.cases</span>(.)] <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># drops speed</span>
<span class="st">  </span>drop_empty_cols</code></pre></div>
<pre><code>##       tailnum year                    type                  manufacturer
##    1:  N10156 2004 Fixed wing multi engine                       EMBRAER
##    2:  N102UW 1998 Fixed wing multi engine              AIRBUS INDUSTRIE
##    3:  N103US 1999 Fixed wing multi engine              AIRBUS INDUSTRIE
##    4:  N104UW 1999 Fixed wing multi engine              AIRBUS INDUSTRIE
##    5:  N10575 2002 Fixed wing multi engine                       EMBRAER
##   ---                                                                   
## 3295:  N997AT 2002 Fixed wing multi engine                        BOEING
## 3296:  N997DL 1992 Fixed wing multi engine MCDONNELL DOUGLAS AIRCRAFT CO
## 3297:  N998AT 2002 Fixed wing multi engine                        BOEING
## 3298:  N998DL 1992 Fixed wing multi engine MCDONNELL DOUGLAS CORPORATION
## 3299:  N999DN 1992 Fixed wing multi engine MCDONNELL DOUGLAS CORPORATION
##           model engines seats    engine
##    1: EMB-145XR       2    55 Turbo-fan
##    2:  A320-214       2   182 Turbo-fan
##    3:  A320-214       2   182 Turbo-fan
##    4:  A320-214       2   182 Turbo-fan
##    5: EMB-145LR       2    55 Turbo-fan
##   ---                                  
## 3295:   717-200       2   100 Turbo-fan
## 3296:     MD-88       2   142 Turbo-fan
## 3297:   717-200       2   100 Turbo-fan
## 3298:     MD-88       2   142 Turbo-jet
## 3299:     MD-88       2   142 Turbo-jet</code></pre>
</div>
<div id="duplicated_rows" class="section level2">
<h2><code>duplicated_rows</code></h2>
<p>There are many useful functions for detecting duplicates in R. However, in interactive use, I often want to not merely see which values are duplicated, but also compare them to the original. This is especially true when I am comparing duplicates across a <em>subset</em> of columns in a a <code>data.table</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># only the 'second' of the duplicates is returned</span>
<span class="st">  </span>.[<span class="kw">duplicated</span>(., <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;origin&quot;</span>, <span class="st">&quot;dest&quot;</span>))]  </code></pre></div>
<pre><code>##         year month day dep_time sched_dep_time dep_delay arr_time
##      1: 2013     1   1      600            600         0      837
##      2: 2013     1   1      607            607         0      858
##      3: 2013     1   1      608            600         8      807
##      4: 2013     1   1      623            627        -4      933
##      5: 2013     1   1      624            630        -6      840
##     ---                                                          
## 336548: 2013     9  30       NA           1455        NA       NA
## 336549: 2013     9  30       NA           2200        NA       NA
## 336550: 2013     9  30       NA           1210        NA       NA
## 336551: 2013     9  30       NA           1159        NA       NA
## 336552: 2013     9  30       NA            840        NA       NA
##         sched_arr_time arr_delay carrier flight tailnum origin dest
##      1:            825        12      MQ   4650  N542MQ    LGA  ATL
##      2:            915       -17      UA   1077  N53442    EWR  MIA
##      3:            735        32      MQ   3768  N9EAMQ    EWR  ORD
##      4:            932         1      UA    496  N459UA    LGA  IAH
##      5:            830        10      MQ   4599  N518MQ    LGA  MSP
##     ---                                                            
## 336548:           1634        NA      9E   3393      NA    JFK  DCA
## 336549:           2312        NA      9E   3525      NA    LGA  SYR
## 336550:           1330        NA      MQ   3461  N535MQ    LGA  BNA
## 336551:           1344        NA      MQ   3572  N511MQ    LGA  CLE
## 336552:           1020        NA      MQ   3531  N839MQ    LGA  RDU
##         air_time distance hour minute           time_hour
##      1:      134      762    6      0 2013-01-01 06:00:00
##      2:      157     1085    6      7 2013-01-01 06:00:00
##      3:      139      719    6      0 2013-01-01 06:00:00
##      4:      229     1416    6     27 2013-01-01 06:00:00
##      5:      166     1020    6     30 2013-01-01 06:00:00
##     ---                                                  
## 336548:       NA      213   14     55 2013-09-30 14:00:00
## 336549:       NA      198   22      0 2013-09-30 22:00:00
## 336550:       NA      764   12     10 2013-09-30 12:00:00
## 336551:       NA      419   11     59 2013-09-30 11:00:00
## 336552:       NA      431    8     40 2013-09-30 08:00:00</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Both rows are returned and (by default)</span>
<span class="st">  </span><span class="co"># duplicates are presented adjacently</span>
<span class="st">  </span><span class="kw">duplicated_rows</span>(<span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;origin&quot;</span>, <span class="st">&quot;dest&quot;</span>))</code></pre></div>
<pre><code>##         year month day dep_time sched_dep_time dep_delay arr_time
##      1: 2013     1   1     1315           1317        -2     1413
##      2: 2013     1   1     1655           1621        34     1804
##      3: 2013     1   1     2056           2004        52     2156
##      4: 2013     1   2     1332           1327         5     1419
##      5: 2013     1   2     1746           1621        85     1835
##     ---                                                          
## 336767: 2013     9  27     1516           1520        -4     1739
## 336768: 2013     9  29     1754           1755        -1     2019
## 336769: 2013     9  30      719            725        -6      916
## 336770: 2013     9  30     1519           1520        -1     1726
## 336771: 2013     9  30     1747           1755        -8     1941
##         sched_arr_time arr_delay carrier flight tailnum origin dest
##      1:           1423       -10      EV   4112  N13538    EWR  ALB
##      2:           1724        40      EV   3260  N19554    EWR  ALB
##      3:           2112        44      EV   4170  N12540    EWR  ALB
##      4:           1433       -14      EV   4316  N14153    EWR  ALB
##      5:           1724        71      EV   3260  N14153    EWR  ALB
##     ---                                                            
## 336767:           1740        -1      MQ   3532  N724MQ    LGA  XNA
## 336768:           2015         4      MQ   3713  N725MQ    LGA  XNA
## 336769:            945       -29      MQ   3547  N735MQ    LGA  XNA
## 336770:           1740       -14      MQ   3532  N725MQ    LGA  XNA
## 336771:           2015       -34      MQ   3713  N720MQ    LGA  XNA
##         air_time distance hour minute           time_hour
##      1:       33      143   13     17 2013-01-01 13:00:00
##      2:       36      143   16     21 2013-01-01 16:00:00
##      3:       31      143   20      4 2013-01-01 20:00:00
##      4:       33      143   13     27 2013-01-02 13:00:00
##      5:       31      143   16     21 2013-01-02 16:00:00
##     ---                                                  
## 336767:      160     1147   15     20 2013-09-27 15:00:00
## 336768:      160     1147   17     55 2013-09-29 17:00:00
## 336769:      150     1147    7     25 2013-09-30 07:00:00
## 336770:      148     1147   15     20 2013-09-30 15:00:00
## 336771:      146     1147   17     55 2013-09-30 17:00:00</code></pre>
</div>
<div id="haversine-distance" class="section level2">
<h2>Haversine distance</h2>
<p>To emphasize the miscellany of this package, I now present <code>haversine_distance</code> which simply returns the distance between two points on the Earth, given their latitutde and longitude.</p>
<p>I prefer this to other packages’ implementations. Although the <code>geosphere</code> package can do a lot more than calculate distances between points, I find the interface for <code>distHaversine</code> unfortunate as it cannot be easily used inside a <code>data.frame</code>. In addition, I’ve found the arguments clearer in <code>hutils::haversine_distance</code> rather than trying to remember whether to use <code>byrow</code> inside the <code>matrix</code> function while passing to <code>distHaversine</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT1 &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">lat_orig =</span> <span class="kw">runif</span>(<span class="fl">1e5</span>, <span class="op">-</span><span class="dv">80</span>, <span class="dv">80</span>),
                  <span class="dt">lon_orig =</span> <span class="kw">runif</span>(<span class="fl">1e5</span>, <span class="op">-</span><span class="dv">179</span>, <span class="dv">179</span>),
                  <span class="dt">lat_dest =</span> <span class="kw">runif</span>(<span class="fl">1e5</span>, <span class="op">-</span><span class="dv">80</span>, <span class="dv">80</span>),
                  <span class="dt">lon_dest =</span> <span class="kw">runif</span>(<span class="fl">1e5</span>, <span class="op">-</span><span class="dv">179</span>, <span class="dv">179</span>))

DT2 &lt;-<span class="st"> </span><span class="kw">copy</span>(DT1)

<span class="kw">microbenchmark</span>(DT1[, distance <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">haversine_distance</span>(lat_orig, lon_orig,
                                                    lat_dest, lon_dest)],
               
               DT2[, distance <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">distHaversine</span>(<span class="kw">cbind</span>(lon_orig, lat_orig),
                                               <span class="kw">cbind</span>(lon_orig, lat_orig))])</code></pre></div>
<pre><code>## Unit: milliseconds
##                                                                                             expr
##           DT1[, `:=`(distance, haversine_distance(lat_orig, lon_orig, lat_dest,      lon_dest))]
##  DT2[, `:=`(distance, distHaversine(cbind(lon_orig, lat_orig),      cbind(lon_orig, lat_orig)))]
##       min       lq     mean   median       uq      max neval cld
##  20.69082 20.99034 23.53692 21.16020 21.61227 137.8780   100  a 
##  50.14316 56.49257 64.10422 58.22057 60.60588 172.1796   100   b</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(DT1, DT2)</code></pre></div>
</div>
<div id="mutate_other" class="section level2">
<h2><code>mutate_other</code></h2>
<p>There may be occasions where a categorical variable in a <code>data.table</code> may need to modified to reduce the number of distinct categories. For example, you may want to plot a chart with a set number of facets, or ensure the smooth operation of <code>randomForest</code>, which accepts no more than 32 levels in a feature.</p>
<p><code>mutate_other</code> keeps the <em>n</em> most common categories and changes the other categories to <code>Other</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">Fruit =</span> <span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;pear&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;tomato&quot;</span>, <span class="st">&quot;eggplant&quot;</span>),
                                <span class="dt">size =</span> <span class="dv">20</span>,
                                <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.45</span>, <span class="fl">0.25</span>, <span class="fl">0.15</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>),
                                <span class="dt">replace =</span> <span class="ot">TRUE</span>),
                 <span class="dt">Price =</span> <span class="kw">rpois</span>(<span class="dv">20</span>, <span class="dv">10</span>))

<span class="kw">kable</span>(<span class="kw">mutate_other</span>(DT, <span class="st">&quot;Fruit&quot;</span>, <span class="dt">n =</span> <span class="dv">3</span>)[])</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Fruit</th>
<th align="right">Price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">apple</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">apple</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">pear</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">apple</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">Other</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">pear</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">pear</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">apple</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">apple</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">apple</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">pear</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">apple</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">Other</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">pear</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">Other</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">apple</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="right">9</td>
</tr>
</tbody>
</table>
</div>
<div id="ngrep" class="section level2">
<h2><code>ngrep</code></h2>
<p>This is a ‘dumb’ negation of <code>grep</code>. In recent versions of R, the option <code>invert = FALSE</code> exists. A slight advantage of <code>ngrep</code> is that it’s shorter to type. But if you don’t have arthritis, best use <code>invert = FALSE</code> or <code>!grepl</code>.</p>
</div>
<div id="notin-ein-enotin-pin" class="section level2">
<h2><code>notin</code> <code>ein</code> <code>enotin</code> <code>pin</code></h2>
<p>These functions provide complementary functionality to <code>%in%</code>:</p>
<div id="notin" class="section level3">
<h3><code>%notin%</code></h3>
<p><code>%notin%</code> is the negation of <code>%in%</code>, but also uses the package <code>fastmatch</code> to increase the speed of the operation</p>
</div>
<div id="ein-and-enotin" class="section level3">
<h3><code>%ein%</code> and <code>%enotin%</code></h3>
<p>The functions <code>%ein%</code> and <code>%enotin%</code> are motivated by a different sort of problem. Consider the following statement:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(iris)
iris[Species <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;setosa&quot;</span>, <span class="st">&quot;versicolour&quot;</span>)] <span class="op">%$%</span>
<span class="st">  </span><span class="kw">mean</span>(Sepal.Length <span class="op">/</span><span class="st"> </span>Sepal.Width)</code></pre></div>
<pre><code>## [1] 1.470188</code></pre>
<p>On the face of it, this appears to give the average ratio of <em>Iris setosa</em> and <em>Iris versicolour</em> irises. However, it only gives the average ratio of <em>setosa</em> irises, as the correct spelling is <em>Iris versicolor</em> not <em>-our</em>. This particular error is easy to make, (in fact when I wrote this vignette, the first hit of Google for <code>iris dataset</code> made the same spelling error), but it’s easy to imagine similar mistakes, such as mistaking the capitalization of a value. The functions <code>%ein%</code> and <code>%enotin%</code> strive to reduce the occurence of this mistake. The functions operate exactly the same as <code>%in%</code> and <code>%enotin%</code> but error if any of the table of values to be matched against is not present in any of the values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(iris)
iris[Species <span class="op">%ein%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;setosa&quot;</span>, <span class="st">&quot;versicolour&quot;</span>)] <span class="op">%$%</span>
<span class="st">  </span><span class="kw">mean</span>(Sepal.Length <span class="op">/</span><span class="st"> </span>Sepal.Width)</code></pre></div>
<pre><code>## Error: `rhs` contained versicolour, but this value was not found in `lhs = Species`. All values of `rhs` must be in `lhs`. Ensure you have specified `rhs` correctly.</code></pre>
<p>The <code>e</code> stands for ‘exists’; <em>i.e.</em> they should be read as “exists and in” and “exists and not in”.</p>
</div>
<div id="pin" class="section level3">
<h3><code>%pin%</code></h3>
<p>This performs a partial match (<em>i.e</em> <code>grepl</code>) but with a possibly more readable or intuitive syntax</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">identical</span>(iris[<span class="kw">grep</span>(<span class="st">&quot;v&quot;</span>, Species)],
          iris[Species <span class="op">%pin%</span><span class="st"> &quot;v&quot;</span>])</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>If the RHS has more than one element, the matching is done on alternation (<em>i.e.</em> OR):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris[Species <span class="op">%pin%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ver&quot;</span>, <span class="st">&quot;vir&quot;</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>head</code></pre></div>
<pre><code>##    Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
## 1:          7.0         3.2          4.7         1.4 versicolor
## 2:          6.4         3.2          4.5         1.5 versicolor
## 3:          6.9         3.1          4.9         1.5 versicolor
## 4:          5.5         2.3          4.0         1.3 versicolor
## 5:          6.5         2.8          4.6         1.5 versicolor
## 6:          5.7         2.8          4.5         1.3 versicolor</code></pre>
<p>There is an important qualification: if the RHS is <code>NULL</code>, then the result will be <code>TRUE</code> along the length of <code>x</code>, contrary to the behaviour of <code>%in%</code>. This is not entirely unexpected as <code>NULL</code> could legitimately be interpreted as <span class="math inline">\(\varepsilon\)</span>, the empty regular expression, which occurs in every string.</p>
</div>
<div id="provide.dir" class="section level3">
<h3><code>provide.dir</code></h3>
<p>This is the same as <code>dir.create</code> but checks whether the target exists or not and does nothing if it does. Motivated by <code>\providecommand</code> in <span class="math inline">\(\rm\LaTeX{}\)</span>, which creates a macro only if it does not exist already.</p>
</div>
<div id="select_which" class="section level3">
<h3><code>select_which</code></h3>
<p>This provides a similar role to <code>dplyr::select_if</code> but was originally part of <code>package:grattan</code> so has a different name. It simply returns the columns whose <em>values</em> return <code>TRUE</code> when <code>Which</code> is applied. Additional columns (which may or not may satisfy <code>Which</code>) may be incldued bny using <code>.and.dots</code>. (To remove columns, you can use <code>drop_col</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,
                 <span class="dt">y =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>],
                 <span class="dt">AB =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>))
<span class="kw">select_which</span>(DT, anyNA, <span class="dt">.and.dots =</span> <span class="st">&quot;y&quot;</span>)</code></pre></div>
<pre><code>##       AB y
## 1:    NA a
## 2:  TRUE b
## 3: FALSE c
## 4:  TRUE d
## 5: FALSE e</code></pre>
</div>
<div id="set_cols_first" class="section level3">
<h3><code>set_cols_first</code></h3>
<p>Up to and including <code>data.table 1.10.4</code>, one could only reorder the columns by supplying all the columns. You can use <code>set_cols_first</code> and <code>set_cols_last</code> to put columns first or last without supplying all the columns.</p>
</div>
<div id="unique-keys" class="section level3">
<h3>Unique keys</h3>
<p>In some circumstances, you need to know that the <code>key</code> of a <code>data.table</code> is unique. For example, you may expect a join to be performed later, without specifying <code>mult='first'</code> or permitting Cartesian joins. <code>data.table</code> does not require a <code>key</code> to be unique and does not supply tools to check the uniqueness of keys. <code>hutils</code> supplies two simple functions: <code>has_unique_key</code> which when applied to a <code>data.table</code> returns <code>TRUE</code> if and only if the table has a key and it is unique.</p>
<p><code>set_unique_key</code> does the same as <code>setkey</code> but will error if the resultant key is not unique.</p>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
