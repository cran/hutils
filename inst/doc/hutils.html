<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Hugh Parsonage" />

<meta name="date" content="2019-05-31" />

<title>Hutils</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Hutils</h1>
<h4 class="author">Hugh Parsonage</h4>
<h4 class="date">2019-05-31</h4>



<div id="hutils-package" class="section level1">
<h1><code>hutils</code> package</h1>
<p>My name is Hugh. I’ve written some miscellaneous functions that don’t seem to belong in a particular package. I’ve usually put these in <code>R/utils.R</code> when I write a package. Thus, <code>hutils</code>.</p>
<p>This vignette just goes through each exported function.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(knitr)</a>
<a class="sourceLine" id="cb1-2" title="2">suggested_packages &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;geosphere&quot;</span>, <span class="st">&quot;nycflights13&quot;</span>, <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>, <span class="st">&quot;microbenchmark&quot;</span>)</a>
<a class="sourceLine" id="cb1-3" title="3">opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">eval =</span> <span class="kw">all</span>(<span class="kw">vapply</span>(suggested_packages, requireNamespace, <span class="dt">quietly =</span> <span class="ot">TRUE</span>, <span class="dt">FUN.VALUE =</span> <span class="ot">FALSE</span>)))</a></code></pre></div>
<pre><code>## Registered S3 methods overwritten by &#39;ggplot2&#39;:
##   method         from 
##   [.quosures     rlang
##   c.quosures     rlang
##   print.quosures rlang</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">tryCatch</span>({</a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="kw">library</span>(geosphere)</a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="kw">library</span>(dplyr, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb3-6" title="6">  <span class="kw">library</span>(microbenchmark)</a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="kw">library</span>(data.table, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-8" title="8">  <span class="kw">library</span>(magrittr)</a>
<a class="sourceLine" id="cb3-9" title="9">  <span class="kw">library</span>(hutils, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-10" title="10">}, </a>
<a class="sourceLine" id="cb3-11" title="11"><span class="co"># requireNamespace does not detect errors like</span></a>
<a class="sourceLine" id="cb3-12" title="12"><span class="co"># package ‘dplyr’ was installed by an R version with different internals; it needs to be reinstalled for use with this R version</span></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="dt">error =</span> <span class="cf">function</span>(e) {</a>
<a class="sourceLine" id="cb3-14" title="14">  opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">eval =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-15" title="15">})</a>
<a class="sourceLine" id="cb3-16" title="16"><span class="kw">options</span>(<span class="dt">digits =</span> <span class="dv">4</span>)</a></code></pre></div>
<div id="aliases" class="section level2">
<h2>Aliases</h2>
<p>These are simple additions to <code>magrittr</code>‘s aliases, including: capitalized forms of <code>and</code> and <code>or</code> that invoke <code>&amp;&amp;</code> and <code>||</code> (the ’long-form’ logical operators) and <code>nor</code> / <code>neither</code> functions.</p>
<p>The main motivation is to make the source code easier to indent. I occasionally find such source code easier to use.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">OR</span>(<span class="kw">OR</span>(<span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb4-2" title="2">      <span class="kw">stop</span>(<span class="st">&quot;Never happens&quot;</span>)),  <span class="co">## short-circuits</span></a>
<a class="sourceLine" id="cb4-3" title="3">   <span class="kw">AND</span>(<span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb4-4" title="4">       <span class="kw">stop</span>(<span class="st">&quot;Never happens&quot;</span>)))  </a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p><code>nor</code> (or <code>neither</code> which is identical) returns <code>TRUE</code> if and only if both arguments are <code>FALSE</code>.</p>
</div>
<div id="coalesce-and-if_else" class="section level2">
<h2><code>coalesce</code> and <code>if_else</code></h2>
<p>These are near drop-in replacements for the equivalent functions from <code>dplyr</code>. They are included here because they are very useful outside of the tidyverse, but may be required in circumstances where importing <code>dplyr</code> (with all of its dependencies) would be inappropriate.</p>
<p>They attempt to be drop-in replacements but:</p>
<ol style="list-style-type: decimal">
<li><code>hutils::if_else</code> only works with <code>logical</code>, <code>integer</code>, <code>double</code>, and <code>character</code> type vectors. Lists and factors won’t work.</li>
<li><code>hutils::coalesce</code> short-circuits on its first argument; if there are no <code>NA</code>s in <code>x</code> then <code>x</code> is returned, even if the other vectors are the wrong length or type.</li>
</ol>
<p>In addition, <code>hutils::if_else</code> is generally faster than <code>dplyr::if_else</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">my_check &lt;-<span class="st"> </span><span class="cf">function</span>(values) {</a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="kw">all</span>(<span class="kw">vapply</span>(values[<span class="op">-</span><span class="dv">1</span>], <span class="cf">function</span>(x) <span class="kw">identical</span>(values[[<span class="dv">1</span>]], x), <span class="kw">logical</span>(<span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb6-3" title="3">}</a>
<a class="sourceLine" id="cb6-4" title="4"></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="kw">set.seed</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb6-6" title="6">cnd &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-7" title="7">yes &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-8" title="8">no &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-9" title="9">na &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-10" title="10"></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr<span class="op">::</span><span class="kw">if_else</span>(cnd, yes, no, na),</a>
<a class="sourceLine" id="cb6-12" title="12">               <span class="dt">hutils =</span> hutils<span class="op">::</span><span class="kw">if_else</span>(cnd, yes, no, na),</a>
<a class="sourceLine" id="cb6-13" title="13">               <span class="dt">check =</span> my_check) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="st">  </span>print</a></code></pre></div>
<pre><code>## Unit: milliseconds
##    expr   min    lq  mean median     uq   max neval
##   dplyr 7.794 8.223 9.915  9.682 10.115 16.47   100
##  hutils 2.646 2.774 4.320  3.077  3.373 55.12   100</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">cnd &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-2" title="2">yes &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-3" title="3">no &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-4" title="4">na &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-5" title="5"></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr<span class="op">::</span><span class="kw">if_else</span>(cnd, yes, no, na),</a>
<a class="sourceLine" id="cb8-7" title="7">               <span class="dt">hutils =</span> hutils<span class="op">::</span><span class="kw">if_else</span>(cnd, yes, no, na),</a>
<a class="sourceLine" id="cb8-8" title="8">               <span class="dt">check =</span> my_check) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="st">  </span>print</a></code></pre></div>
<pre><code>## Unit: milliseconds
##    expr   min    lq  mean median    uq    max neval
##   dplyr 6.654 6.935 8.500  7.437 8.349 61.639   100
##  hutils 1.704 1.832 2.139  1.911 2.102  6.662   100</code></pre>
<p>This speed advantage also appears to be true of <code>coalesce</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb10-2" title="2">A &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb10-3" title="3">B &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb10-4" title="4">C &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb10-5" title="5"></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr<span class="op">::</span><span class="kw">coalesce</span>(x, A, B, C),</a>
<a class="sourceLine" id="cb10-7" title="7">               <span class="dt">hutils =</span> hutils<span class="op">::</span><span class="kw">coalesce</span>(x, A, B, C),</a>
<a class="sourceLine" id="cb10-8" title="8">               <span class="dt">check =</span> my_check) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="st">  </span>print</a></code></pre></div>
<pre><code>## Unit: milliseconds
##    expr   min    lq  mean median    uq    max neval
##   dplyr 2.529 2.675 3.747  2.757 3.282 55.401   100
##  hutils 1.115 1.175 1.564  1.243 1.547  4.729   100</code></pre>
<p>especially during short-circuits:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr<span class="op">::</span><span class="kw">coalesce</span>(x, A, B, C),</a>
<a class="sourceLine" id="cb12-4" title="4">               <span class="dt">hutils =</span> hutils<span class="op">::</span><span class="kw">coalesce</span>(x, A, B, C),</a>
<a class="sourceLine" id="cb12-5" title="5">               <span class="dt">check =</span> my_check) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="st">  </span>print</a></code></pre></div>
<pre><code>## Unit: microseconds
##    expr     min      lq    mean  median      uq    max neval
##   dplyr 2262.36 2302.56 2723.59 2397.73 2755.85 5321.4   100
##  hutils   65.22   67.69   90.21   83.07   99.48  238.7   100</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb14-2" title="2">A &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb14-3" title="3"></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr<span class="op">::</span><span class="kw">coalesce</span>(x, A, B, C),</a>
<a class="sourceLine" id="cb14-5" title="5">               <span class="dt">hutils =</span> hutils<span class="op">::</span><span class="kw">coalesce</span>(x, A, B, C),</a>
<a class="sourceLine" id="cb14-6" title="6">               <span class="dt">check =</span> my_check) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="st">  </span>print</a></code></pre></div>
<pre><code>## Unit: microseconds
##    expr    min     lq mean median     uq   max neval
##   dplyr 2395.3 2496.4 3013 2594.8 3063.3  6258   100
##  hutils  629.3  735.9 1420  797.1  891.6 54125   100</code></pre>
</div>
<div id="drop-columns" class="section level2">
<h2>Drop columns</h2>
<p>To drop a column from a <code>data.table</code>, you set it to <code>NULL</code></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">A =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">B =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">C =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb16-2" title="2">DT[, A <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</a></code></pre></div>
<p>There’s nothing wrong with this, but I’ve found the following a useful alias, especially in a <code>magrittr</code> pipe.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">A =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">B =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">C =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb17-2" title="2">DT <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="st">  </span><span class="kw">drop_col</span>(<span class="st">&quot;A&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="st">  </span><span class="kw">drop_col</span>(<span class="st">&quot;B&quot;</span>)</a></code></pre></div>
<pre><code>##    C
## 1: 1
## 2: 2
## 3: 3
## 4: 4
## 5: 5</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="co"># or</span></a>
<a class="sourceLine" id="cb19-2" title="2">DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">A =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">B =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">C =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb19-3" title="3">DT <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-4" title="4"><span class="st">  </span><span class="kw">drop_cols</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>))</a></code></pre></div>
<pre><code>##    C
## 1: 1
## 2: 2
## 3: 3
## 4: 4
## 5: 5</code></pre>
<p>These functions simple invoke the canonical form, so won’t be any faster.</p>
<p>Additionally, one can drop columns by a regular expression using <code>drop_colr</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">flights &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(flights)</a>
<a class="sourceLine" id="cb21-2" title="2"></a>
<a class="sourceLine" id="cb21-3" title="3">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-4" title="4"><span class="st">  </span><span class="kw">drop_colr</span>(<span class="st">&quot;time&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-5" title="5"><span class="st">  </span><span class="kw">drop_colr</span>(<span class="st">&quot;arr(?!_delay)&quot;</span>, <span class="dt">perl =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##         year month day dep_delay arr_delay flight tailnum origin dest
##      1: 2013     1   1         2        11   1545  N14228    EWR  IAH
##      2: 2013     1   1         4        20   1714  N24211    LGA  IAH
##      3: 2013     1   1         2        33   1141  N619AA    JFK  MIA
##      4: 2013     1   1        -1       -18    725  N804JB    JFK  BQN
##      5: 2013     1   1        -6       -25    461  N668DN    LGA  ATL
##     ---                                                              
## 336772: 2013     9  30        NA        NA   3393    &lt;NA&gt;    JFK  DCA
## 336773: 2013     9  30        NA        NA   3525    &lt;NA&gt;    LGA  SYR
## 336774: 2013     9  30        NA        NA   3461  N535MQ    LGA  BNA
## 336775: 2013     9  30        NA        NA   3572  N511MQ    LGA  CLE
## 336776: 2013     9  30        NA        NA   3531  N839MQ    LGA  RDU
##         distance hour minute
##      1:     1400    5     15
##      2:     1416    5     29
##      3:     1089    5     40
##      4:     1576    5     45
##      5:      762    6      0
##     ---                     
## 336772:      213   14     55
## 336773:      198   22      0
## 336774:      764   12     10
## 336775:      419   11     59
## 336776:      431    8     40</code></pre>
</div>
<div id="drop_constant_cols" class="section level2">
<h2><code>drop_constant_cols</code></h2>
<p>When a table is filtered, the filtrate is often redundant.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-2" title="2"><span class="st">  </span>.[origin <span class="op">==</span><span class="st"> &quot;JFK&quot;</span>] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-3" title="3"><span class="st">  </span>drop_constant_cols</a></code></pre></div>
<pre><code>##         month day dep_time sched_dep_time dep_delay arr_time
##      1:     1   1      542            540         2      923
##      2:     1   1      544            545        -1     1004
##      3:     1   1      557            600        -3      838
##      4:     1   1      558            600        -2      849
##      5:     1   1      558            600        -2      853
##     ---                                                     
## 111275:     9  30     2240           2250       -10     2347
## 111276:     9  30     2241           2246        -5     2345
## 111277:     9  30     2307           2255        12     2359
## 111278:     9  30     2349           2359       -10      325
## 111279:     9  30       NA           1455        NA       NA
##         sched_arr_time arr_delay carrier flight tailnum dest air_time
##      1:            850        33      AA   1141  N619AA  MIA      160
##      2:           1022       -18      B6    725  N804JB  BQN      183
##      3:            846        -8      B6     79  N593JB  MCO      140
##      4:            851        -2      B6     49  N793JB  PBI      149
##      5:            856        -3      B6     71  N657JB  TPA      158
##     ---                                                              
## 111275:              7       -20      B6   2002  N281JB  BUF       52
## 111276:              1       -16      B6    486  N346JB  ROC       47
## 111277:           2358         1      B6    718  N565JB  BOS       33
## 111278:            350       -25      B6    745  N516JB  PSE      196
## 111279:           1634        NA      9E   3393    &lt;NA&gt;  DCA       NA
##         distance hour minute           time_hour
##      1:     1089    5     40 2013-01-01 05:00:00
##      2:     1576    5     45 2013-01-01 05:00:00
##      3:      944    6      0 2013-01-01 06:00:00
##      4:     1028    6      0 2013-01-01 06:00:00
##      5:     1005    6      0 2013-01-01 06:00:00
##     ---                                         
## 111275:      301   22     50 2013-09-30 22:00:00
## 111276:      264   22     46 2013-09-30 22:00:00
## 111277:      187   22     55 2013-09-30 22:00:00
## 111278:     1617   23     59 2013-09-30 23:00:00
## 111279:      213   14     55 2013-09-30 14:00:00</code></pre>
</div>
<div id="drop_empty_cols" class="section level2">
<h2><code>drop_empty_cols</code></h2>
<p>This function drops columns in which all the values are <code>NA</code>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">planes <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb25-2" title="2"><span class="st">  </span>as.data.table <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb25-3" title="3"><span class="st">  </span>.[<span class="op">!</span><span class="kw">complete.cases</span>(.)]</a></code></pre></div>
<pre><code>##       tailnum year                    type                  manufacturer
##    1:  N10156 2004 Fixed wing multi engine                       EMBRAER
##    2:  N102UW 1998 Fixed wing multi engine              AIRBUS INDUSTRIE
##    3:  N103US 1999 Fixed wing multi engine              AIRBUS INDUSTRIE
##    4:  N104UW 1999 Fixed wing multi engine              AIRBUS INDUSTRIE
##    5:  N10575 2002 Fixed wing multi engine                       EMBRAER
##   ---                                                                   
## 3295:  N997AT 2002 Fixed wing multi engine                        BOEING
## 3296:  N997DL 1992 Fixed wing multi engine MCDONNELL DOUGLAS AIRCRAFT CO
## 3297:  N998AT 2002 Fixed wing multi engine                        BOEING
## 3298:  N998DL 1992 Fixed wing multi engine MCDONNELL DOUGLAS CORPORATION
## 3299:  N999DN 1992 Fixed wing multi engine MCDONNELL DOUGLAS CORPORATION
##           model engines seats speed    engine
##    1: EMB-145XR       2    55    NA Turbo-fan
##    2:  A320-214       2   182    NA Turbo-fan
##    3:  A320-214       2   182    NA Turbo-fan
##    4:  A320-214       2   182    NA Turbo-fan
##    5: EMB-145LR       2    55    NA Turbo-fan
##   ---                                        
## 3295:   717-200       2   100    NA Turbo-fan
## 3296:     MD-88       2   142    NA Turbo-fan
## 3297:   717-200       2   100    NA Turbo-fan
## 3298:     MD-88       2   142    NA Turbo-jet
## 3299:     MD-88       2   142    NA Turbo-jet</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">planes <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-2" title="2"><span class="st">  </span>as.data.table <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-3" title="3"><span class="st">  </span>.[<span class="op">!</span><span class="kw">complete.cases</span>(.)] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-4" title="4"><span class="st">  </span><span class="co"># drops speed</span></a>
<a class="sourceLine" id="cb27-5" title="5"><span class="st">  </span>drop_empty_cols</a></code></pre></div>
<pre><code>##       tailnum year                    type                  manufacturer
##    1:  N10156 2004 Fixed wing multi engine                       EMBRAER
##    2:  N102UW 1998 Fixed wing multi engine              AIRBUS INDUSTRIE
##    3:  N103US 1999 Fixed wing multi engine              AIRBUS INDUSTRIE
##    4:  N104UW 1999 Fixed wing multi engine              AIRBUS INDUSTRIE
##    5:  N10575 2002 Fixed wing multi engine                       EMBRAER
##   ---                                                                   
## 3295:  N997AT 2002 Fixed wing multi engine                        BOEING
## 3296:  N997DL 1992 Fixed wing multi engine MCDONNELL DOUGLAS AIRCRAFT CO
## 3297:  N998AT 2002 Fixed wing multi engine                        BOEING
## 3298:  N998DL 1992 Fixed wing multi engine MCDONNELL DOUGLAS CORPORATION
## 3299:  N999DN 1992 Fixed wing multi engine MCDONNELL DOUGLAS CORPORATION
##           model engines seats    engine
##    1: EMB-145XR       2    55 Turbo-fan
##    2:  A320-214       2   182 Turbo-fan
##    3:  A320-214       2   182 Turbo-fan
##    4:  A320-214       2   182 Turbo-fan
##    5: EMB-145LR       2    55 Turbo-fan
##   ---                                  
## 3295:   717-200       2   100 Turbo-fan
## 3296:     MD-88       2   142 Turbo-fan
## 3297:   717-200       2   100 Turbo-fan
## 3298:     MD-88       2   142 Turbo-jet
## 3299:     MD-88       2   142 Turbo-jet</code></pre>
</div>
<div id="duplicated_rows" class="section level2">
<h2><code>duplicated_rows</code></h2>
<p>There are many useful functions for detecting duplicates in R. However, in interactive use, I often want to not merely see which values are duplicated, but also compare them to the original. This is especially true when I am comparing duplicates across a <em>subset</em> of columns in a a <code>data.table</code>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb29-2" title="2"><span class="st">  </span><span class="co"># only the &#39;second&#39; of the duplicates is returned</span></a>
<a class="sourceLine" id="cb29-3" title="3"><span class="st">  </span>.[<span class="kw">duplicated</span>(., <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;origin&quot;</span>, <span class="st">&quot;dest&quot;</span>))]  </a></code></pre></div>
<pre><code>##         year month day dep_time sched_dep_time dep_delay arr_time
##      1: 2013     1   1      600            600         0      837
##      2: 2013     1   1      607            607         0      858
##      3: 2013     1   1      608            600         8      807
##      4: 2013     1   1      623            627        -4      933
##      5: 2013     1   1      624            630        -6      840
##     ---                                                          
## 336548: 2013     9  30       NA           1455        NA       NA
## 336549: 2013     9  30       NA           2200        NA       NA
## 336550: 2013     9  30       NA           1210        NA       NA
## 336551: 2013     9  30       NA           1159        NA       NA
## 336552: 2013     9  30       NA            840        NA       NA
##         sched_arr_time arr_delay carrier flight tailnum origin dest
##      1:            825        12      MQ   4650  N542MQ    LGA  ATL
##      2:            915       -17      UA   1077  N53442    EWR  MIA
##      3:            735        32      MQ   3768  N9EAMQ    EWR  ORD
##      4:            932         1      UA    496  N459UA    LGA  IAH
##      5:            830        10      MQ   4599  N518MQ    LGA  MSP
##     ---                                                            
## 336548:           1634        NA      9E   3393    &lt;NA&gt;    JFK  DCA
## 336549:           2312        NA      9E   3525    &lt;NA&gt;    LGA  SYR
## 336550:           1330        NA      MQ   3461  N535MQ    LGA  BNA
## 336551:           1344        NA      MQ   3572  N511MQ    LGA  CLE
## 336552:           1020        NA      MQ   3531  N839MQ    LGA  RDU
##         air_time distance hour minute           time_hour
##      1:      134      762    6      0 2013-01-01 06:00:00
##      2:      157     1085    6      7 2013-01-01 06:00:00
##      3:      139      719    6      0 2013-01-01 06:00:00
##      4:      229     1416    6     27 2013-01-01 06:00:00
##      5:      166     1020    6     30 2013-01-01 06:00:00
##     ---                                                  
## 336548:       NA      213   14     55 2013-09-30 14:00:00
## 336549:       NA      198   22      0 2013-09-30 22:00:00
## 336550:       NA      764   12     10 2013-09-30 12:00:00
## 336551:       NA      419   11     59 2013-09-30 11:00:00
## 336552:       NA      431    8     40 2013-09-30 08:00:00</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-2" title="2"><span class="st">  </span><span class="co"># Both rows are returned and (by default)</span></a>
<a class="sourceLine" id="cb31-3" title="3"><span class="st">  </span><span class="co"># duplicates are presented adjacently</span></a>
<a class="sourceLine" id="cb31-4" title="4"><span class="st">  </span><span class="kw">duplicated_rows</span>(<span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;origin&quot;</span>, <span class="st">&quot;dest&quot;</span>))</a></code></pre></div>
<pre><code>##         year month day dep_time sched_dep_time dep_delay arr_time
##      1: 2013     1   1     1315           1317        -2     1413
##      2: 2013     1   1     1655           1621        34     1804
##      3: 2013     1   1     2056           2004        52     2156
##      4: 2013     1   2     1332           1327         5     1419
##      5: 2013     1   2     1746           1621        85     1835
##     ---                                                          
## 336767: 2013     9  27     1516           1520        -4     1739
## 336768: 2013     9  29     1754           1755        -1     2019
## 336769: 2013     9  30      719            725        -6      916
## 336770: 2013     9  30     1519           1520        -1     1726
## 336771: 2013     9  30     1747           1755        -8     1941
##         sched_arr_time arr_delay carrier flight tailnum origin dest
##      1:           1423       -10      EV   4112  N13538    EWR  ALB
##      2:           1724        40      EV   3260  N19554    EWR  ALB
##      3:           2112        44      EV   4170  N12540    EWR  ALB
##      4:           1433       -14      EV   4316  N14153    EWR  ALB
##      5:           1724        71      EV   3260  N14153    EWR  ALB
##     ---                                                            
## 336767:           1740        -1      MQ   3532  N724MQ    LGA  XNA
## 336768:           2015         4      MQ   3713  N725MQ    LGA  XNA
## 336769:            945       -29      MQ   3547  N735MQ    LGA  XNA
## 336770:           1740       -14      MQ   3532  N725MQ    LGA  XNA
## 336771:           2015       -34      MQ   3713  N720MQ    LGA  XNA
##         air_time distance hour minute           time_hour
##      1:       33      143   13     17 2013-01-01 13:00:00
##      2:       36      143   16     21 2013-01-01 16:00:00
##      3:       31      143   20      4 2013-01-01 20:00:00
##      4:       33      143   13     27 2013-01-02 13:00:00
##      5:       31      143   16     21 2013-01-02 16:00:00
##     ---                                                  
## 336767:      160     1147   15     20 2013-09-27 15:00:00
## 336768:      160     1147   17     55 2013-09-29 17:00:00
## 336769:      150     1147    7     25 2013-09-30 07:00:00
## 336770:      148     1147   15     20 2013-09-30 15:00:00
## 336771:      146     1147   17     55 2013-09-30 17:00:00</code></pre>
</div>
<div id="haversine-distance" class="section level2">
<h2>Haversine distance</h2>
<p>To emphasize the miscellany of this package, I now present <code>haversine_distance</code> which simply returns the distance between two points on the Earth, given their latitude and longitude.</p>
<p>I prefer this to other packages’ implementations. Although the <code>geosphere</code> package can do a lot more than calculate distances between points, I find the interface for <code>distHaversine</code> unfortunate as it cannot be easily used inside a <code>data.frame</code>. In addition, I’ve found the arguments clearer in <code>hutils::haversine_distance</code> rather than trying to remember whether to use <code>byrow</code> inside the <code>matrix</code> function while passing to <code>distHaversine</code>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1">DT1 &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">lat_orig =</span> <span class="kw">runif</span>(<span class="fl">1e5</span>, <span class="dv">-80</span>, <span class="dv">80</span>),</a>
<a class="sourceLine" id="cb33-2" title="2">                  <span class="dt">lon_orig =</span> <span class="kw">runif</span>(<span class="fl">1e5</span>, <span class="dv">-179</span>, <span class="dv">179</span>),</a>
<a class="sourceLine" id="cb33-3" title="3">                  <span class="dt">lat_dest =</span> <span class="kw">runif</span>(<span class="fl">1e5</span>, <span class="dv">-80</span>, <span class="dv">80</span>),</a>
<a class="sourceLine" id="cb33-4" title="4">                  <span class="dt">lon_dest =</span> <span class="kw">runif</span>(<span class="fl">1e5</span>, <span class="dv">-179</span>, <span class="dv">179</span>))</a>
<a class="sourceLine" id="cb33-5" title="5"></a>
<a class="sourceLine" id="cb33-6" title="6">DT2 &lt;-<span class="st"> </span><span class="kw">copy</span>(DT1)</a>
<a class="sourceLine" id="cb33-7" title="7"></a>
<a class="sourceLine" id="cb33-8" title="8"><span class="kw">microbenchmark</span>(DT1[, <span class="dt">distance :=</span> <span class="kw">haversine_distance</span>(lat_orig, lon_orig,</a>
<a class="sourceLine" id="cb33-9" title="9">                                                    lat_dest, lon_dest)],</a>
<a class="sourceLine" id="cb33-10" title="10">               </a>
<a class="sourceLine" id="cb33-11" title="11">               DT2[, <span class="dt">distance :=</span> <span class="kw">distHaversine</span>(<span class="kw">cbind</span>(lon_orig, lat_orig),</a>
<a class="sourceLine" id="cb33-12" title="12">                                               <span class="kw">cbind</span>(lon_orig, lat_orig))])</a></code></pre></div>
<pre><code>## Unit: milliseconds
##                                                                                             expr
##           DT1[, `:=`(distance, haversine_distance(lat_orig, lon_orig, lat_dest,      lon_dest))]
##  DT2[, `:=`(distance, distHaversine(cbind(lon_orig, lat_orig),      cbind(lon_orig, lat_orig)))]
##    min    lq  mean median    uq    max neval
##  27.56 27.97 29.93  28.24 28.56 101.39   100
##  47.95 49.44 55.69  51.35 61.90  69.67   100</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="kw">rm</span>(DT1, DT2)</a></code></pre></div>
</div>
<div id="mutate_other" class="section level2">
<h2><code>mutate_other</code></h2>
<p>There may be occasions where a categorical variable in a <code>data.table</code> may need to modified to reduce the number of distinct categories. For example, you may want to plot a chart with a set number of facets, or ensure the smooth operation of <code>randomForest</code>, which accepts no more than 32 levels in a feature.</p>
<p><code>mutate_other</code> keeps the <em>n</em> most common categories and changes the other categories to <code>Other</code>.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb36-2" title="2">DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">Fruit =</span> <span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;pear&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;tomato&quot;</span>, <span class="st">&quot;eggplant&quot;</span>),</a>
<a class="sourceLine" id="cb36-3" title="3">                                <span class="dt">size =</span> <span class="dv">20</span>,</a>
<a class="sourceLine" id="cb36-4" title="4">                                <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.45</span>, <span class="fl">0.25</span>, <span class="fl">0.15</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>),</a>
<a class="sourceLine" id="cb36-5" title="5">                                <span class="dt">replace =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb36-6" title="6">                 <span class="dt">Price =</span> <span class="kw">rpois</span>(<span class="dv">20</span>, <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb36-7" title="7"></a>
<a class="sourceLine" id="cb36-8" title="8"><span class="kw">kable</span>(<span class="kw">mutate_other</span>(DT, <span class="st">&quot;Fruit&quot;</span>, <span class="dt">n =</span> <span class="dv">3</span>)[])</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Fruit</th>
<th align="right">Price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">apple</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">apple</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">pear</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">apple</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">Other</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">pear</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">pear</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">apple</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">apple</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">apple</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">pear</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">apple</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">Other</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">pear</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">Other</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">apple</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="right">9</td>
</tr>
</tbody>
</table>
</div>
<div id="ngrep" class="section level2">
<h2><code>ngrep</code></h2>
<p>This is a ‘dumb’ negation of <code>grep</code>. In recent versions of R, the option <code>invert = FALSE</code> exists. A slight advantage of <code>ngrep</code> is that it’s shorter to type. But if you don’t have arthritis, best use <code>invert = FALSE</code> or <code>!grepl</code>.</p>
</div>
<div id="notin-ein-enotin-pin" class="section level2">
<h2><code>notin</code> <code>ein</code> <code>enotin</code> <code>pin</code></h2>
<p>These functions provide complementary functionality to <code>%in%</code>:</p>
<div id="notin" class="section level3">
<h3><code>%notin%</code></h3>
<p><code>%notin%</code> is the negation of <code>%in%</code>, but also uses the package <code>fastmatch</code> to increase the speed of the operation</p>
</div>
<div id="ein-and-enotin" class="section level3">
<h3><code>%ein%</code> and <code>%enotin%</code></h3>
<p>The functions <code>%ein%</code> and <code>%enotin%</code> are motivated by a different sort of problem. Consider the following statement:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1">iris &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(iris)</a>
<a class="sourceLine" id="cb37-2" title="2">iris[Species <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;setosa&quot;</span>, <span class="st">&quot;versicolour&quot;</span>)] <span class="op">%$%</span></a>
<a class="sourceLine" id="cb37-3" title="3"><span class="st">  </span><span class="kw">mean</span>(Sepal.Length <span class="op">/</span><span class="st"> </span>Sepal.Width)</a></code></pre></div>
<pre><code>## [1] 1.47</code></pre>
<p>On the face of it, this appears to give the average ratio of <em>Iris setosa</em> and <em>Iris versicolour</em> irises. However, it only gives the average ratio of <em>setosa</em> irises, as the correct spelling is <em>Iris versicolor</em> not <em>-our</em>. This particular error is easy to make, (in fact when I wrote this vignette, the first hit of Google for <code>iris dataset</code> made the same spelling error), but it’s easy to imagine similar mistakes, such as mistaking the capitalization of a value. The functions <code>%ein%</code> and <code>%enotin%</code> strive to reduce the occurrence of this mistake. The functions operate exactly the same as <code>%in%</code> and <code>%enotin%</code> but error if any of the table of values to be matched against is not present in any of the values:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1">iris &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(iris)</a>
<a class="sourceLine" id="cb39-2" title="2">iris[Species <span class="op">%ein%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;setosa&quot;</span>, <span class="st">&quot;versicolour&quot;</span>)] <span class="op">%$%</span></a>
<a class="sourceLine" id="cb39-3" title="3"><span class="st">  </span><span class="kw">mean</span>(Sepal.Length <span class="op">/</span><span class="st"> </span>Sepal.Width)</a></code></pre></div>
<pre><code>## Error: `rhs` contained versicolour, but this value was not found in `lhs = Species`. All values of `rhs` must be in `lhs`. Ensure you have specified `rhs` correctly.</code></pre>
<p>The <code>e</code> stands for ‘exists’; <em>i.e.</em> they should be read as “exists and in” and “exists and not in”.</p>
</div>
<div id="pin" class="section level3">
<h3><code>%pin%</code></h3>
<p>This performs a partial match (<em>i.e</em> <code>grepl</code>) but with a possibly more readable or intuitive syntax</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1"><span class="kw">identical</span>(iris[<span class="kw">grep</span>(<span class="st">&quot;v&quot;</span>, Species)],</a>
<a class="sourceLine" id="cb41-2" title="2">          iris[Species <span class="op">%pin%</span><span class="st"> &quot;v&quot;</span>])</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>If the RHS has more than one element, the matching is done on alternation (<em>i.e.</em> OR):</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1">iris[Species <span class="op">%pin%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ver&quot;</span>, <span class="st">&quot;vir&quot;</span>)] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb43-2" title="2"><span class="st">  </span>head</a></code></pre></div>
<pre><code>##    Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
## 1:          7.0         3.2          4.7         1.4 versicolor
## 2:          6.4         3.2          4.5         1.5 versicolor
## 3:          6.9         3.1          4.9         1.5 versicolor
## 4:          5.5         2.3          4.0         1.3 versicolor
## 5:          6.5         2.8          4.6         1.5 versicolor
## 6:          5.7         2.8          4.5         1.3 versicolor</code></pre>
<p>There is an important qualification: if the RHS is <code>NULL</code>, then the result will be <code>TRUE</code> along the length of <code>x</code>, contrary to the behaviour of <code>%in%</code>. This is not entirely unexpected as <code>NULL</code> could legitimately be interpreted as <span class="math inline">\(\varepsilon\)</span>, the empty regular expression, which occurs in every string.</p>
</div>
<div id="provide.dir" class="section level3">
<h3><code>provide.dir</code></h3>
<p>This is the same as <code>dir.create</code> but checks whether the target exists or not and does nothing if it does. Motivated by <code>\providecommand</code> in <span class="math inline">\(\rm\LaTeX{}\)</span>, which creates a macro only if it does not exist already.</p>
</div>
<div id="select_which" class="section level3">
<h3><code>select_which</code></h3>
<p>This provides a similar role to <code>dplyr::select_if</code> but was originally part of <code>package:grattan</code> so has a different name. It simply returns the columns whose <em>values</em> return <code>TRUE</code> when <code>Which</code> is applied. Additional columns (which may or not may satisfy <code>Which</code>) may be included by using <code>.and.dots</code>. (To remove columns, you can use <code>drop_col</code>).</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1">DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb45-2" title="2">                 <span class="dt">y =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>],</a>
<a class="sourceLine" id="cb45-3" title="3">                 <span class="dt">AB =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb45-4" title="4"><span class="kw">select_which</span>(DT, anyNA, <span class="dt">.and.dots =</span> <span class="st">&quot;y&quot;</span>)</a></code></pre></div>
<pre><code>##       AB y
## 1:    NA a
## 2:  TRUE b
## 3: FALSE c
## 4:  TRUE d
## 5: FALSE e</code></pre>
</div>
<div id="set_cols_first" class="section level3">
<h3><code>set_cols_first</code></h3>
<p>Up to and including <code>data.table 1.10.4</code>, one could only reorder the columns by supplying all the columns. You can use <code>set_cols_first</code> and <code>set_cols_last</code> to put columns first or last without supplying all the columns.</p>
</div>
<div id="unique-keys" class="section level3">
<h3>Unique keys</h3>
<p>In some circumstances, you need to know that the <code>key</code> of a <code>data.table</code> is unique. For example, you may expect a join to be performed later, without specifying <code>mult=&#39;first&#39;</code> or permitting Cartesian joins. <code>data.table</code> does not require a <code>key</code> to be unique and does not supply tools to check the uniqueness of keys. <code>hutils</code> supplies two simple functions: <code>has_unique_key</code> which when applied to a <code>data.table</code> returns <code>TRUE</code> if and only if the table has a key and it is unique.</p>
<p><code>set_unique_key</code> does the same as <code>setkey</code> but will error if the resultant key is not unique.</p>
</div>
</div>
<div id="hutils-v1.1.0" class="section level2">
<h2><code>hutils</code> v1.1.0</h2>
<div id="auc" class="section level3">
<h3><code>auc</code></h3>
<p>The area under the <a href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">(ROC) curve</a> gives a single value to measure the tradeoff between true positives and false positives.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1">dt &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">y =</span> <span class="op">!</span><span class="kw">sample</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">100</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>), </a>
<a class="sourceLine" id="cb47-2" title="2">                 <span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">100</span>))</a>
<a class="sourceLine" id="cb47-3" title="3">dt[, pred <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">predict</span>(<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> .SD), <span class="dt">newdata =</span> .SD)]</a>
<a class="sourceLine" id="cb47-4" title="4"></a>
<a class="sourceLine" id="cb47-5" title="5">dt[, <span class="kw">auc</span>(y, pred)]</a></code></pre></div>
<pre><code>## [1] 0.577</code></pre>
</div>
<div id="select_grep" class="section level3">
<h3><code>select_grep</code></h3>
<p>To select columns matching a regular expression:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb49-2" title="2"><span class="st">  </span><span class="kw">select_grep</span>(<span class="st">&quot;arr&quot;</span>)</a></code></pre></div>
<pre><code>##         arr_time sched_arr_time arr_delay carrier
##      1:      830            819        11      UA
##      2:      850            830        20      UA
##      3:      923            850        33      AA
##      4:     1004           1022       -18      B6
##      5:      812            837       -25      DL
##     ---                                          
## 336772:       NA           1634        NA      9E
## 336773:       NA           2312        NA      9E
## 336774:       NA           1330        NA      MQ
## 336775:       NA           1344        NA      MQ
## 336776:       NA           1020        NA      MQ</code></pre>
<p>You can use the additional arguments <code>.and</code> and <code>.but.not</code> to override the patterns.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-2" title="2"><span class="st">  </span><span class="kw">select_grep</span>(<span class="st">&quot;arr&quot;</span>, <span class="dt">.and =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">.but.not =</span> <span class="st">&quot;arr_time&quot;</span>)</a></code></pre></div>
<pre><code>##         year sched_arr_time arr_delay carrier
##      1: 2013            819        11      UA
##      2: 2013            830        20      UA
##      3: 2013            850        33      AA
##      4: 2013           1022       -18      B6
##      5: 2013            837       -25      DL
##     ---                                      
## 336772: 2013           1634        NA      9E
## 336773: 2013           2312        NA      9E
## 336774: 2013           1330        NA      MQ
## 336775: 2013           1344        NA      MQ
## 336776: 2013           1020        NA      MQ</code></pre>
</div>
</div>
<div id="hutils-v1.2.0" class="section level2">
<h2><code>hutils</code> v1.2.0</h2>
<div id="rq" class="section level3">
<h3><code>RQ</code></h3>
<p>This is simply a shorthand to test whether a package needs installing. The package name need not be quoted, for convenience.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1"><span class="kw">RQ</span>(dplyr, <span class="st">&quot;dplyr must be installed&quot;</span>)</a></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" title="1"><span class="kw">RQ</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;dplyr needs installing&quot;</span>, <span class="st">&quot;dplyr installed.&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;dplyr installed.&quot;</code></pre>
</div>
<div id="ahull" class="section level3">
<h3><code>ahull</code></h3>
<p>This locates the biggest rectangle beneath a curve:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1"><span class="kw">ggplot</span>(<span class="kw">data.table</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">0.1</span>, <span class="dv">0</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb57-2" title="2"><span class="st">  </span><span class="kw">geom_area</span>(<span class="kw">aes</span>(x, y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb57-3" title="3"><span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> <span class="kw">ahull</span>(, <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">0.1</span>, <span class="dv">0</span>)),</a>
<a class="sourceLine" id="cb57-4" title="4">            <span class="kw">aes</span>(<span class="dt">xmin =</span> xmin,</a>
<a class="sourceLine" id="cb57-5" title="5">                <span class="dt">xmax =</span> xmax,</a>
<a class="sourceLine" id="cb57-6" title="6">                <span class="dt">ymin =</span> ymin,</a>
<a class="sourceLine" id="cb57-7" title="7">                <span class="dt">ymax =</span> ymax),</a>
<a class="sourceLine" id="cb57-8" title="8">            <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) </a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" title="1"><span class="kw">set.seed</span>(<span class="dv">101</span>)</a>
<a class="sourceLine" id="cb58-2" title="2">ahull_dt &lt;-</a>
<a class="sourceLine" id="cb58-3" title="3"><span class="st">  </span><span class="kw">data.table</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">100</span>) <span class="op">/</span><span class="st"> </span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb58-4" title="4">             <span class="dt">y =</span> <span class="kw">cumsum</span>(<span class="kw">rnorm</span>(<span class="dv">101</span>, <span class="fl">0.05</span>)))</a>
<a class="sourceLine" id="cb58-5" title="5"><span class="kw">ggplot</span>(ahull_dt) <span class="op">+</span></a>
<a class="sourceLine" id="cb58-6" title="6"><span class="st">  </span><span class="kw">geom_area</span>(<span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb58-7" title="7"><span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> <span class="kw">ahull</span>(ahull_dt), </a>
<a class="sourceLine" id="cb58-8" title="8">            <span class="kw">aes</span>(<span class="dt">xmin =</span> xmin, </a>
<a class="sourceLine" id="cb58-9" title="9">                <span class="dt">xmax =</span> xmax, </a>
<a class="sourceLine" id="cb58-10" title="10">                <span class="dt">ymin =</span> ymin, </a>
<a class="sourceLine" id="cb58-11" title="11">                <span class="dt">ymax =</span> ymax), </a>
<a class="sourceLine" id="cb58-12" title="12">            <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb58-13" title="13"><span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> <span class="kw">ahull</span>(ahull_dt,</a>
<a class="sourceLine" id="cb58-14" title="14">                         <span class="dt">incl_negative =</span> <span class="ot">TRUE</span>), </a>
<a class="sourceLine" id="cb58-15" title="15">            <span class="kw">aes</span>(<span class="dt">xmin =</span> xmin, </a>
<a class="sourceLine" id="cb58-16" title="16">                <span class="dt">xmax =</span> xmax, </a>
<a class="sourceLine" id="cb58-17" title="17">                <span class="dt">ymin =</span> ymin, </a>
<a class="sourceLine" id="cb58-18" title="18">                <span class="dt">ymax =</span> ymax), </a>
<a class="sourceLine" id="cb58-19" title="19">            <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb58-20" title="20"><span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> <span class="kw">ahull</span>(ahull_dt,</a>
<a class="sourceLine" id="cb58-21" title="21">                         <span class="dt">incl_negative =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb58-22" title="22">                         <span class="dt">minH =</span> <span class="dv">4</span>), </a>
<a class="sourceLine" id="cb58-23" title="23">            <span class="kw">aes</span>(<span class="dt">xmin =</span> xmin, </a>
<a class="sourceLine" id="cb58-24" title="24">                <span class="dt">xmax =</span> xmax, </a>
<a class="sourceLine" id="cb58-25" title="25">                <span class="dt">ymin =</span> ymin, </a>
<a class="sourceLine" id="cb58-26" title="26">                <span class="dt">ymax =</span> ymax), </a>
<a class="sourceLine" id="cb58-27" title="27">            <span class="dt">color =</span> <span class="st">&quot;green&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb58-28" title="28"><span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> <span class="kw">ahull</span>(ahull_dt,</a>
<a class="sourceLine" id="cb58-29" title="29">                         <span class="dt">incl_negative =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb58-30" title="30">                         <span class="dt">minW =</span> <span class="fl">0.25</span>), </a>
<a class="sourceLine" id="cb58-31" title="31">            <span class="kw">aes</span>(<span class="dt">xmin =</span> xmin, </a>
<a class="sourceLine" id="cb58-32" title="32">                <span class="dt">xmax =</span> xmax, </a>
<a class="sourceLine" id="cb58-33" title="33">                <span class="dt">ymin =</span> ymin, </a>
<a class="sourceLine" id="cb58-34" title="34">                <span class="dt">ymax =</span> ymax), </a>
<a class="sourceLine" id="cb58-35" title="35">            <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>,</a>
<a class="sourceLine" id="cb58-36" title="36">            <span class="dt">fill =</span> <span class="ot">NA</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
</div>
<div id="hutils-v1.3.0" class="section level2">
<h2><code>hutils</code> v1.3.0</h2>
<div id="weighted_quantile" class="section level3">
<h3><code>weighted_quantile</code></h3>
<p>Simply a version of <code>quantile</code> supporting weighted values:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb59-2" title="2">w &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="kw">rep</span>(<span class="dv">2</span>, <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb59-3" title="3"><span class="kw">quantile</span>(x, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>), <span class="dt">names =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## [1] 3.25 7.75</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1"><span class="kw">weighted_quantile</span>(x, w, <span class="dt">p =</span> <span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>))</a></code></pre></div>
<pre><code>## [1] 4 9</code></pre>
</div>
<div id="mutate_ntile" class="section level3">
<h3><code>mutate_ntile</code></h3>
<p>To add a column of ntiles (say, for later summarizing):</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb63-2" title="2"><span class="st">  </span>as.data.table <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb63-3" title="3"><span class="st">  </span>.[, .(year, month, day, origin, dest, distance)] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb63-4" title="4"><span class="st">  </span><span class="kw">mutate_ntile</span>(distance, <span class="dt">n =</span> 5L)</a></code></pre></div>
<pre><code>##         year month day origin dest distance distanceQuintile
##      1: 2013     1   1    EWR  IAH     1400                4
##      2: 2013     1   1    LGA  IAH     1416                4
##      3: 2013     1   1    JFK  MIA     1089                4
##      4: 2013     1   1    JFK  BQN     1576                4
##      5: 2013     1   1    LGA  ATL      762                3
##     ---                                                     
## 336772: 2013     9  30    JFK  DCA      213                1
## 336773: 2013     9  30    LGA  SYR      198                1
## 336774: 2013     9  30    LGA  BNA      764                3
## 336775: 2013     9  30    LGA  CLE      419                1
## 336776: 2013     9  30    LGA  RDU      431                2</code></pre>
<p>You can use non-standard evaluation (as above) or you can quote the <code>col</code> argument. Use <code>character.only = TRUE</code> to ensure column is only interpreted as character.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" title="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb65-2" title="2"><span class="st">  </span>as.data.table <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb65-3" title="3"><span class="st">  </span>.[, .(year, month, day, origin, dest, distance)] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb65-4" title="4"><span class="st">  </span><span class="kw">mutate_ntile</span>(distance, <span class="dt">n =</span> 5L)</a></code></pre></div>
<pre><code>##         year month day origin dest distance distanceQuintile
##      1: 2013     1   1    EWR  IAH     1400                4
##      2: 2013     1   1    LGA  IAH     1416                4
##      3: 2013     1   1    JFK  MIA     1089                4
##      4: 2013     1   1    JFK  BQN     1576                4
##      5: 2013     1   1    LGA  ATL      762                3
##     ---                                                     
## 336772: 2013     9  30    JFK  DCA      213                1
## 336773: 2013     9  30    LGA  SYR      198                1
## 336774: 2013     9  30    LGA  BNA      764                3
## 336775: 2013     9  30    LGA  CLE      419                1
## 336776: 2013     9  30    LGA  RDU      431                2</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" title="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb67-2" title="2"><span class="st">  </span>as.data.table <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb67-3" title="3"><span class="st">  </span><span class="kw">mutate_ntile</span>(<span class="st">&quot;distance&quot;</span>,</a>
<a class="sourceLine" id="cb67-4" title="4">               <span class="dt">n =</span> 5L,</a>
<a class="sourceLine" id="cb67-5" title="5">               <span class="dt">character.only =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb67-6" title="6"><span class="st">  </span>.[, dep_delay <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">coalesce</span>(dep_delay, <span class="dv">0</span>)] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb67-7" title="7"><span class="st">  </span>.[, .(<span class="dt">avgDelay =</span> <span class="kw">mean</span>(dep_delay)), keyby =<span class="st"> &quot;distanceQuintile&quot;</span>]</a></code></pre></div>
<pre><code>##    distanceQuintile avgDelay
## 1:                1    12.88
## 2:                2    12.97
## 3:                3    13.14
## 4:                4    11.49
## 5:                5    11.16</code></pre>
</div>
<div id="longest_affix" class="section level3">
<h3><code>longest_affix</code></h3>
<p>Trim common affixes can be useful during data cleaning:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" title="1"><span class="kw">trim_common_affixes</span>(<span class="kw">c</span>(<span class="st">&quot;CurrentHousingCosts(weekly)&quot;</span>,</a>
<a class="sourceLine" id="cb69-2" title="2">                      <span class="st">&quot;CurrentFuelCosts(weekly)&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;Housing&quot; &quot;Fuel&quot;</code></pre>
</div>
</div>
<div id="hutils-1.4.0" class="section level2">
<h2><code>hutils 1.4.0</code></h2>
<div id="section" class="section level3">
<h3><code>%&lt;-&gt;%</code></h3>
<p>Referred to as <code>swap</code> in the documentation. Used to swap values between object names</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" title="1">a &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb71-2" title="2">b &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb71-3" title="3">a <span class="op">%&lt;-&gt;%</span><span class="st"> </span>b</a>
<a class="sourceLine" id="cb71-4" title="4"><span class="kw">identical</span>(<span class="kw">c</span>(a, b), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="average_bearing" class="section level3">
<h3><code>average_bearing</code></h3>
<p>Determine the average bearing of vectors. Slightly more difficult than simply the average modulo 360 since its the most acute sector is desired.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" title="1"><span class="kw">average_bearing</span>(<span class="dv">0</span>, <span class="dv">270</span>)  <span class="co"># NW</span></a></code></pre></div>
<pre><code>## [1] 315</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" title="1"><span class="kw">mean</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">270</span>))          <span class="co"># SE (i.e. wrong)</span></a></code></pre></div>
<pre><code>## [1] 135</code></pre>
</div>
<div id="dir2" class="section level3">
<h3><code>dir2</code></h3>
<p>This is a faster version of <code>list.files</code> for Windows only, utilizing the <code>dir</code> command on the command prompt.</p>
</div>
<div id="mode" class="section level3">
<h3><code>Mode</code></h3>
<p>The statistical mode; the most common element.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" title="1"><span class="kw">Mode</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
</div>
<div id="replace_pattern_in" class="section level3">
<h3><code>replace_pattern_in</code></h3>
<p>A cousin of <code>find_pattern_in</code>, but instead of collecting the results, it replaces the contents sought with the replacement provided.</p>
</div>
<div id="samp" class="section level3">
<h3><code>samp</code></h3>
<p>A safer version of <code>sample</code>. I use it because I found the following behaviour of sample surprising.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" title="1">DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb79-2" title="2">                 <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb79-3" title="3">DT[, .(<span class="dt">Base =</span> <span class="kw">sample</span>(.BY[[<span class="st">&quot;x&quot;</span>]]<span class="op">:</span>.BY[[<span class="st">&quot;y&quot;</span>]])), keyby =<span class="st"> </span>.(x, y)]</a></code></pre></div>
<pre><code>##    x y Base
## 1: 2 3    2
## 2: 2 3    3
## 3: 3 4    3
## 4: 3 4    4
## 5: 5 5    3
## 6: 5 5    1
## 7: 5 5    5
## 8: 5 5    4
## 9: 5 5    2</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" title="1">DT[, .(<span class="dt">Base =</span> <span class="kw">samp</span>(.BY[[<span class="st">&quot;x&quot;</span>]]<span class="op">:</span>.BY[[<span class="st">&quot;y&quot;</span>]])), keyby =<span class="st"> </span>.(x, y)]</a></code></pre></div>
<pre><code>## `length(x) = 1`, so returning `rep.int(x, 1)`.</code></pre>
<pre><code>##    x y Base
## 1: 2 3    2
## 2: 2 3    3
## 3: 3 4    3
## 4: 3 4    4
## 5: 5 5    5</code></pre>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
